--PROCEDURE INSERT THÔNG TIN NHÂN VIÊN M?I VÀO B?NG NHÂN VIÊN
CREATE PROCEDURE PCD_insert_NHANVIEN
(
@MANV INT,
@TENNV NVARCHAR(20),
@GIOITINH VARCHAR(3),
@NSINH DATE,
@SDT INT,
@DCHI NVARCHAR(20)
)
AS
BEGIN
INSERT INTO KHACHHANG(MANV,TENNV,GIOITINH,NSINH,SDT,DCHI)VALUES
(@MANV,@TENNV,@GIOITINH,@NSINH,@SDT,@DCHI)
END

EXEC PCD_insert_NHANVIEN 121, 'Nguy?n Minh Hi?u', N'Nam', '21-07-2004', 0913055119, 'An Giang'
EXEC PCD_insert_NHANVIEN 122, 'Tr?n Minh Giàu', N'Nam', '2001-01-19', 06784451245, 'Ngh? An'
EXEC PCD_insert_NHANVIEN 123, 'Nguy?n Khánh Duy', N'Nam', '1999-07-26', 0913654111, 'Thanh Hóa'
EXEC PCD_insert_NHANVIEN 124, 'Tr?n Th? Ng?c Minh', N'N?', '1989-08-30', 0907080044, 'Hà N?i'
EXEC PCD_insert_NHANVIEN 125, 'Nguy?n Th? H?ng Nguyên', N'N?', '1997-07-19', 0901323675, 'Long An' 


-- PROCEDURE QUY TRÌNH ??T PHÒNG NH?P D? LI?U VÀO B?NG DATPHONG VÀ SET TÌNH TR?NG AVAILABLE SANG FULL
CREATE PROCEDURE PCD_DATPHONG_NHAPDULIEU
(
@MAPHIEUDAT NVARCHAR(10) ,
@MAKH INT,
@NGAYTAO DATE,
@NGAYTRAPHONG DATE,
@MAPHONG NVARCHAR(10),
@TRATRUOC INT,
@MADICHVU NVARCHAR(10),
@MANV INT
)
AS
BEGIN
INSERT INTO DATPHONG
(MAPHIEUDAT,MAKH,NGAYTAO,NGAYTRAPHONG,MAPHONG,TRATRUOC,MADICHVU,MANV) VALUES
(@MAPHIEUDAT,@MAKH,@NGAYTAO,@NGAYTRAPHONG,@MAPHONG,@TRATRUOC,@MADICHVU,@MANV)
UPDATE PHONG SET TINHTRANG='FULL' WHERE @MAPHONG=MAPHONG
END
 
EXEC PCD_DATPHONG_NHAPDULIEU 'PD13', 022,'2023-04-30','2023-05-19', '881', 200000, 'VU09', 125
EXEC PCD_DATPHONG_NHAPDULIEU 'PD14', 023, '2023-05-01', '2023-05-10', '885', 1000000, 'VU06', 121
EXEC PCD_DATPHONG_NHAPDULIEU 'PD15', 024, '2023-06-18', '2023-06-20', '901', 300000, 'VU06', 124
EXEC PCD_DATPHONG_NHAPDULIEU 'PD16', 025, '2023-05-29', '2023-06-02', '888', 500000, 'VU05', 123
EXEC PCD_DATPHONG_NHAPDULIEU 'PD17', 026, '2023-04-13', '2023-04-15', '889', 2000000, 'VU07', 122 

-- PROCEDURE THANH TOÁN HÓA ??N VÀ L?U VÔ B?NG HÓA ??N (SET TÌNH TR?NG T? FULL SANG AVAILABLE
CREATE PROCEDURE HOANTAT_THANHTOAN
(
@MAHOADON NVARCHAR(10),
@MAPHONG NVARCHAR(10),
@NGAYTHANHTOAN DATE,
@SOTIENTRATRUOC INT,
@MANV INT,
@MAPHIEUDATPHONG NVARCHAR(10),
@MADICHVU NVARCHAR(10),
@TONGSOTIENPHAITRA INT 
)
AS
BEGIN
DECLARE @TONGTIEN FLOAT = (SELECT (SUM(PHIEUDICHVU.GIA)+SUM(PHONG.GIAPHONG))-DATPHONG.TRATRUOC FROM DATPHONG 
JOIN PHONG ON PHONG.MAPHONG = DATPHONG.MAPHONG 
JOIN PHIEUDICHVU ON PHIEUDICHVU.MAPHIEUDICHVU = DATPHONG.MADICHVU
WHERE DATPHONG.MAPHONG=@MAPHONG)
INSERT INTO HOADON
(MAHOADON,NGAYTHANHTOAN,SOTIENTRATRUOC,MANV,MAPHIEUDATPHONG,MADICHVU,TONGSOTIENPHAITRA)
VALUES
(@MAHOADON,@NGAYTHANHTOAN,@SOTIENTRATRUOC,@MANV,@MAPHIEUDATPHONG,@MADICHVU,@TONGSOTIENPHAITRA)
UPDATE PHONG SET TINHTRANG='AVAILABLE' WHERE @MAPHONG=MAPHONG
END

EXEC HOANTAT_THANHTOAN 'HD13', '881', '2023-05-19', 200000, 125, 'VU09', 'PD13', 610000
EXEC HOANTAT_THANHTOAN 'HD14', '885', '2023-05-10', 1000000, 121, 'PD14', 'VU06', 850000
EXEC HOANTAT_THANHTOAN 'HD15', '901', '2023-06-20', 300000, 124, 'PD15', 'VU06', 3100000
EXEC HOANTAT_THANHTOAN 'HD16', '888', '2023-06-02', 500000, 123, 'PD16', 'VU05', 860000
EXEC HOANTAT_THANHTOAN 'HD17', '889', '2023-04-15', 500000, 122, 'PD17', 'VU07', 870000